<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Campus Rideshare</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .welcome-pill {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 22px;
    width: fit-content;
    border-radius: 999px; /* this makes it cylindrical */
    background: rgba(0, 0, 0);
    color: white;
    font-weight: 600;
    font-size: 1rem;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.3);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.wave {
    animation: wave 1.5s infinite;
}

@keyframes wave {
    0% { transform: rotate(0deg); }
    20% { transform: rotate(20deg); }
    40% { transform: rotate(-10deg); }
    60% { transform: rotate(20deg); }
    100% { transform: rotate(0deg); }
}
    </style>
</head>
<body>
<div class="container">
    <header class="header">
        <div class="welcome-pill">
            <span>Apnaवाहन</span>
        </div>
    </header>

    <div class="form-container">
        <h2 style="text-align: center; color: #667eea; margin-bottom: 30px;">Welcome Back</h2>

        <div id="alert-container"></div>

        <form id="login-form">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                Login
            </button>
        </form>

        <p style="text-align: center; margin-top: 20px; color: #666;">
            Don't have an account? <a href="/signup.html" style="color: #667eea;">Sign Up</a>
        </p>
    </div>
</div>

<script>
    const API_BASE =
      window.location.hostname === 'localhost'
        ? 'http://localhost:8080/api'
        : '/api';


        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            };

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(formData)
                });

                const data = await response.json();


                if (response.ok) {
                    showAlert('Login successful! Redirecting...', 'success');
                    localStorage.setItem('user', JSON.stringify(data));
                    setTimeout(() => {
                        if (data.rider === true) {
                            window.location.href = '/rider-dashboard.html';
                        } else {
                            window.location.href = '/find-ride.html';
                        }

                    }, 1000);
                } else {
                    showAlert(data.message || 'Invalid credentials', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('Network error. Please try again.', 'error');
            }
        });

        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            alertContainer.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }
</script>
</body>
</html>